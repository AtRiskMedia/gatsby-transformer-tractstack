{"version":3,"sources":["src/provider.js"],"names":["defaultValue","TractStackContext","TractStackProvider","children","queries","queryMatch","setQueryMatch","storystep","setStorystep","gotoStorystep","storystep_goto","localStorage","setItem","JSON","stringify","nextStorystep","num_storysteps","parse","getItem","prevStorystep","Math","min","window","document","body","scrollDiv","createElement","setAttribute","appendChild","calculateValue","type","scrollbarWidth","documentElement","style","setProperty","removeChild","mediaQueryLists","keys","Object","isAttached","local_storystep","handleQueryListener","updatedMatches","reduce","acc","media","matches","matchMedia","forEach","addListener","removeListener","pixelWidth","context","actions","propTypes","PropTypes","element","isRequired","object"],"mappings":"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","sourcesContent":["/* global localStorage */\nimport PropTypes from 'prop-types';\nimport React, {useState, useEffect, createContext} from 'react';\n\nconst defaultValue = {};\n\nconst TractStackContext = createContext(defaultValue);\n\nconst TractStackProvider = ({children, queries}) => {\n  const [queryMatch, setQueryMatch] = useState({});\n  const [storystep, setStorystep] = useState(0);\n  const gotoStorystep = (storystep_goto) => {\n    localStorage.setItem('storystep', JSON.stringify(storystep_goto));\n    setStorystep(storystep_goto);\n  };\n  const nextStorystep = () => {\n    let num_storysteps = JSON.parse(localStorage.getItem('num_storysteps'));\n    if (storystep < num_storysteps) {\n      localStorage.setItem('storystep', JSON.stringify(storystep + 1));\n      setStorystep(storystep + 1);\n    }\n  };\n  const prevStorystep = () => {\n    localStorage.setItem(\n      'storystep',\n      JSON.stringify(Math.min(1, storystep - 1))\n    );\n    setStorystep(Math.min(storystep - 1));\n  };\n\n  if (typeof window !== 'undefined' && document) {\n    // set scrollbar offset variable\n    const {body} = document;\n    const scrollDiv = document.createElement('div');\n    // Append element with defined styling\n    scrollDiv.setAttribute(\n      'style',\n      'width: 1337px; height: 1337px; position: absolute; left: -9999px; overflow: scroll;'\n    );\n    body.appendChild(scrollDiv);\n    // Collect width & height of scrollbar\n    // from https://tobbelindstrom.com/blog/measure-scrollbar-width-and-height/\n    const calculateValue = (type) =>\n      scrollDiv[`offset${type}`] - scrollDiv[`client${type}`];\n    const scrollbarWidth = calculateValue('Width');\n    document.documentElement.style.setProperty('--offset', scrollbarWidth);\n    // Remove element\n    body.removeChild(scrollDiv);\n  }\n\n  useEffect(() => {\n    const mediaQueryLists = {};\n    const keys = Object.keys(queries);\n    let isAttached = false;\n    const local_storystep = JSON.parse(localStorage.getItem('storystep'));\n    if (local_storystep && storystep !== local_storystep) {\n      setStorystep(local_storystep);\n    }\n\n    const handleQueryListener = () => {\n      const updatedMatches = keys.reduce((acc, media) => {\n        acc[media] = !!(\n          mediaQueryLists[media] && mediaQueryLists[media].matches\n        );\n        return acc;\n      }, {});\n      setQueryMatch(updatedMatches);\n    };\n\n    if (window && window.matchMedia) {\n      const matches = {};\n      keys.forEach((media) => {\n        if (typeof queries[media] === 'string') {\n          mediaQueryLists[media] = window.matchMedia(queries[media]);\n          matches[media] = mediaQueryLists[media].matches;\n        } else {\n          matches[media] = false;\n        }\n      });\n      setQueryMatch(matches);\n      isAttached = true;\n      keys.forEach((media) => {\n        if (typeof queries[media] === 'string') {\n          mediaQueryLists[media].addListener(handleQueryListener);\n        }\n      });\n    }\n\n    return () => {\n      if (isAttached) {\n        keys.forEach((media) => {\n          if (typeof queries[media] === 'string') {\n            mediaQueryLists[media].removeListener(handleQueryListener);\n          }\n        });\n      }\n    };\n  }, [queries]);\n\n  if (typeof localStorage !== 'undefined') {\n    let pixelWidth = 0;\n    if (queryMatch[360]) pixelWidth = 360;\n    else if (queryMatch[1080]) pixelWidth = 1080;\n    else if (queryMatch[1920]) pixelWidth = 1920;\n    let num_storysteps = JSON.parse(localStorage.getItem('num_storysteps'));\n    let context = {\n      storystep: storystep,\n      num_storysteps: num_storysteps,\n      pixelWidth: pixelWidth,\n      actions: {\n        nextStorystep: nextStorystep,\n        prevStorystep: prevStorystep,\n        gotoStorystep: gotoStorystep,\n      },\n    };\n\n    return (\n      <TractStackContext.Provider value={context}>\n        {children}\n      </TractStackContext.Provider>\n    );\n  }\n  return <></>;\n};\n\nTractStackProvider.propTypes = {\n  children: PropTypes.element.isRequired,\n  queries: PropTypes.object.isRequired,\n};\n\nexport {TractStackContext, TractStackProvider};\n"],"file":"provider.js"}